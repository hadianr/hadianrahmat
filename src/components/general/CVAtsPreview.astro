---
import { info } from "@data";

const formatDate = (date: string): string => {
  if (date === "Present") return "Present";
  return date;
};
---

<div class="cv-ats max-w-4xl mx-auto p-8 bg-white text-black">
  <!-- Header -->
  <header class="text-center mb-6 border-b-2 border-black pb-4">
    <h1 class="text-3xl font-bold mb-1">{info.name}</h1>
    <p class="text-lg mb-2">{info.jobDescription} | Certified Google Cloud Professional Developer</p>
    <div class="flex justify-center gap-2 text-sm mb-2">
      <span>{info.location}</span>
      <span>|</span>
      <span>{info.website}</span>
    </div>
    <div class="flex justify-center gap-4 text-sm">
      <a
        href={`mailto:${info.socialMedia.email.replace("mailto:", "")}`}
        class="hover:underline"
      >
        {info.socialMedia.email.replace("mailto:", "")}
      </a>
      <span>|</span>
      <a href={info.socialMedia.linkedin} class="hover:underline">
        LinkedIn
      </a>
      <span>|</span>
      <a href={info.socialMedia.github} class="hover:underline">
        GitHub
      </a>
    </div>
  </header>

  <!-- Professional Summary -->
  <section class="mb-6">
    <h2 class="text-xl font-bold mb-3 border-b border-black pb-2 uppercase">
      Professional Summary
    </h2>
    <p class="text-justify text-sm leading-relaxed">{info.cvSummary}</p>
  </section>

  <!-- Experience -->
  <section class="mb-6">
    <h2 class="text-xl font-bold mb-3 border-b border-black pb-2 uppercase">
      Experience
    </h2>
    {info.experience.map((exp) => (
      <div class="mb-4">
        <div class="flex justify-between items-start mb-1">
          <h3 class="font-bold text-sm">{exp.location}</h3>
          <span class="text-sm text-gray-700">
            {formatDate(exp.startDate)} - {formatDate(exp.endDate)}
          </span>
        </div>
        <p class="font-semibold text-sm mb-2">{exp.name}</p>
        <div class="text-sm">
          {exp.description.map((desc) => (
            <>
              {desc.startsWith("-") ? (
                <div class="ml-4 text-sm">â€¢ {desc.substring(1).trim()}</div>
              ) : (
                <p class="mb-2">{desc}</p>
              )}
            </>
          ))}
        </div>
      </div>
    ))}
  </section>

  <!-- Education -->
  <section>
    <h2 class="text-xl font-bold mb-3 border-b border-black pb-2 uppercase">
      Education
    </h2>
    {info.education.map((edu) => (
      <div class="mb-4">
        <div class="flex justify-between items-start mb-1">
          <h3 class="font-bold text-sm">{edu.description[0]}</h3>
          <span class="text-sm text-gray-700">
            {edu.startDate} - {edu.endDate}
          </span>
        </div>
        <p class="font-semibold text-sm">{edu.name}</p>
        <p class="text-sm text-gray-700">{edu.location}</p>
      </div>
    ))}
  </section>
</div>

<script>
  // Client-side PDF export functionality
  window.exportCVAsPDF = async function () {
    const element = document.querySelector(".cv-ats");
    if (!element) {
      console.error("CV element not found");
      return;
    }

    try {
      const html2pdf = (await import("html2pdf.js")).default;

      const options = {
        margin: 0.5,
        filename: `Hadian_Rahmat_CV.pdf`,
        image: { type: "jpeg", quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: "in", format: "letter", orientation: "portrait" },
      };

      html2pdf().set(options).from(element).save();
    } catch (error) {
      console.error("Error generating PDF:", error);
    }
  };
</script>

<style>
  .cv-ats {
    font-family: "Calibri", "Arial", sans-serif;
    line-height: 1.4;
  }

  /* Prevent page breaks inside sections */
  .cv-ats section {
    page-break-inside: avoid;
  }

  /* Prevent orphaned headers */
  .cv-ats h2, .cv-ats h3 {
    page-break-after: avoid;
  }

  /* Keep experience entries together */
  .cv-ats .mb-4 {
    page-break-inside: avoid;
  }

  @media print {
    .cv-ats {
      padding: 0;
      margin: 0;
    }
    
    /* Better page break control for print */
    section {
      page-break-inside: avoid;
    }
    
    h2, h3 {
      page-break-after: avoid;
    }
  }
</style>
