---
import Footer from "@components/general/Footer.astro";
import Navbar from "@components/general/Navbar.astro";
import "../styles/style.css";
---

<!-- Critical script: Must run BEFORE HTML parsing completes to prevent CLS -->
<script is:inline>
  // Immediately set theme - minimal to prevent reflow
  (function() {
    try {
      var t = localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', t);
      document.documentElement.style.colorScheme = t;
    } catch (e) {
      document.documentElement.setAttribute('data-theme', 'light');
      document.documentElement.style.colorScheme = 'light';
    }
  })();
</script>

<!-- Critical CSS - Optimized for perfect LCP and zero CLS -->
<style is:inline>
  *{box-sizing:border-box}
  html{font-size:16px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility}
  body{font-family:Inter,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;margin:0;padding:0;min-height:100vh;overflow-x:hidden}
  [data-theme="light"]{background:#FFF;color:#1f2937}
  [data-theme="dark"]{background:#111;color:#f3f4f6}
  h1{font-size:clamp(3rem,8vw,6rem);font-weight:700;line-height:1.1;font-family:Outfit,sans-serif;margin:0;margin-bottom:1rem;contain:layout style paint}
  .container{max-width:56rem;margin:0 auto;padding:0 1rem;contain:layout}
  section{padding-top:2rem;contain:layout style}
  p{margin:0.5rem 0;line-height:1.6;contain:layout style}
  .text-lg{font-size:1.125rem;line-height:1.75rem}
  .mb-16{margin-bottom:4rem}
  .mt-\[32px\]{margin-top:2rem}
  .space-y-4>*+*{margin-top:1rem}
  .skip-link{position:absolute;top:-100px;left:0;z-index:9999}
  img,picture{content-visibility:auto;contain-intrinsic-size:300px 200px}
  .about-content{contain:layout style}
</style>

<!-- Skip to main content link for accessibility -->
<a href="#main-content" class="skip-link" tabindex="0">Skip to main content</a>

<Navbar />
<main id="main-content" class="container">
  <slot />
</main>
<Footer />

<style>
  .skip-link {
    position: absolute;
    top: -100px;
    left: 0;
    background: #2563eb;
    color: white;
    padding: 12px 16px;
    text-decoration: none;
    z-index: 9999;
    border-radius: 0 0 8px 0;
    font-weight: 600;
    transition: top 0.2s ease;
  }
  
  .skip-link:focus {
    top: 0;
    outline: 3px solid #fff;
    outline-offset: 2px;
  }
</style>

<!-- Register Service Worker for offline support and caching -->
<script is:inline>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('/sw.js').catch(function(err) {
        console.log('ServiceWorker registration failed: ', err);
      });
    });
  }
</script>
